document.addEventListener("DOMContentLoaded",function(){var e=new Framework7({el:"#app",name:"Sweet Dreams",theme:"ios",panel:{swipe:!0},routes:[{path:"/",pageName:"home"},{path:"/history/",url:"pages/history.html",on:{pageAfterIn:function(e,t){"function"==typeof loadHistory&&loadHistory()}}},{path:"/info/",url:"pages/info.html",on:{pageInit:function(e,t){console.log("Info page initialized")},pageBeforeIn:function(e,t){console.log("Info page before in")}}},{path:"/settings/",url:"pages/settings.html",on:{pageInit:function(n,i){S(),function(){const n=k();if(n>5){const e=document.querySelector("#daysList ul");for(let i=6;i<=n;i++){const n=document.createElement("li");n.className="item-divider",n.textContent=`Day ${i}`;const a=document.createElement("li");a.className="item-content item-input",a.innerHTML=`\n        <div class="item-inner">\n          <div class="item-title item-label">Check intervals (minutes)</div>\n          <div class="item-input-wrap">\n            <input type="text" id="day${i}" placeholder="4, 5, 6, 6" value="${t[i]?t[i].checks.join(", "):""}">\n          </div>\n        </div>\n      `,e.appendChild(n),e.appendChild(a)}}const i=document.getElementById("settingsForm");i&&i.addEventListener("submit",function(n){n.preventDefault(),function(){const n={};document.querySelectorAll('[id^="day"]').forEach(e=>{const t=e.id.match(/day(\d+)/);if(t){const i=parseInt(t[1]),a=e.value.split(",").map(e=>{const t=parseFloat(e.trim());return isNaN(t)?0:t}).filter(e=>e>0);a.length>0&&(n[i]={checks:a})}}),localStorage.setItem("customIntervalConfig",JSON.stringify(n)),Object.keys(t).forEach(e=>{isNaN(Number(e))||delete t[e]}),Object.assign(t,n),D(),e.dialog.alert("Settings saved successfully!","Success")}()});const a=document.getElementById("addDayBtn");a&&a.addEventListener("click",function(e){e.preventDefault(),function(){const e=document.querySelector("#daysList ul"),t=k()+1,n=document.createElement("li");n.className="item-divider",n.textContent=`Day ${t}`;const i=document.createElement("li");i.className="item-content item-input",i.innerHTML=`\n    <div class="item-inner">\n      <div class="item-title item-label">Check intervals (minutes)</div>\n      <div class="item-input-wrap">\n        <input type="text" id="day${t}" placeholder="4, 5, 6, 6" value="">\n      </div>\n    </div>\n  `,e.appendChild(n),e.appendChild(i)}()});const s=document.getElementById("resetDefaultsBtn");s&&s.addEventListener("click",function(n){n.preventDefault(),e.dialog.confirm("Are you sure you want to reset to default settings?","Reset Settings",function(){localStorage.removeItem("customIntervalConfig"),Object.keys(t).forEach(e=>{isNaN(Number(e))||delete t[e]}),Object.assign(t,{1:{checks:[2,2,3,3]},2:{checks:[2,3,3,4]},3:{checks:[3,4,4,5]},4:{checks:[3,4,5,5]},5:{checks:[4,5,6,6]}}),e.dialog.alert("Settings reset to defaults!","Reset Complete"),window.location.reload()})})}()}}}]});e.views.create(".view-main",{url:"/"});const t={1:{checks:[2,2,3,3]},2:{checks:[2,3,3,4]},3:{checks:[3,4,4,5]},4:{checks:[3,4,5,5]},5:{checks:[4,5,6,6]}};let n={isRunning:!1,isPaused:!1,currentTime:0,currentCheck:0,currentDay:1,interval:null,startTime:null,checkStartTime:null,sessionLog:[]};const i=document.getElementById("timerDisplay"),a=document.getElementById("startBtn"),s=document.getElementById("stopBtn"),o=document.getElementById("checkBtn"),c=document.getElementById("resetQuietBtn"),l=document.getElementById("daySelect"),r=document.getElementById("currentCheck"),d=document.getElementById("waitTime"),m=document.getElementById("sessionLog");function u(){const e=Math.floor(n.currentTime/60),t=n.currentTime%60;i.textContent=`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}function g(){let e=n.currentDay;if(!t[e]){const n=Object.keys(t).map(Number).filter(e=>!isNaN(e));e=Math.max(...n)}const i=t[e],a=n.currentCheck;return a<i.checks.length?i.checks[a]:i.checks[i.checks.length-1]}function y(e){const t=new Date,i={time:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`,message:e,timestamp:t.getTime()};n.sessionLog.push(i),p(),function(){const e=JSON.parse(localStorage.getItem("sleepSessions")||"[]"),t={date:(new Date).toISOString(),day:n.currentDay,log:n.sessionLog,startTime:n.startTime},i=e.findIndex(e=>new Date(e.date).toDateString()===(new Date).toDateString());i>=0?e[i]=t:e.push(t),localStorage.setItem("sleepSessions",JSON.stringify(e))}()}function p(){0===n.sessionLog.length?m.innerHTML='\n      <div class="empty-state">\n        <i class="icon f7-icons">moon_zzz</i>\n        <p>Press "Crying" when baby starts crying</p>\n      </div>\n    ':(m.innerHTML=n.sessionLog.map(e=>`<div class="log-entry">\n        <span class="time">${e.time}</span> - ${e.message}\n      </div>`).join(""),m.scrollTop=m.scrollHeight)}function f(){if(n.isRunning){const e={...n,savedAt:Date.now()};localStorage.setItem("timerState",JSON.stringify(e))}else localStorage.removeItem("timerState")}function v(t){o.disabled=!0,o.classList.remove("color-orange"),y(`Check ${n.currentCheck+1} completed (waited ${t} min)`);let i,c=60;setTimeout(()=>{const t=e.dialog.create({title:"Comfort Time",text:'<div style="text-align: center; padding: 20px;"><div style="font-size: 48px; font-weight: bold; color: var(--f7-theme-color);" id="comfort-timer">1:00</div><div style="margin-top: 10px;">Maximum comfort time</div></div>',buttons:[{text:"Done",bold:!0,onClick:function(){clearInterval(i)}}],on:{opened:function(){i=setInterval(()=>{c--;const e=Math.floor(c/60),n=c%60,a=document.getElementById("comfort-timer");a&&(a.textContent=`${e}:${n.toString().padStart(2,"0")}`),c<=0&&(clearInterval(i),t.close())},1e3)},closed:function(){clearInterval(i),n.currentCheck++,n.currentTime=0,h(),y("Room left after check"),n.isRunning&&(clearInterval(n.interval),n.isRunning=!1,a.style.display="block",s.style.display="none",o.disabled=!0,o.classList.remove("color-orange"),u(),f())}}});t.open()},100)}function h(){r.textContent=n.currentCheck+1,d.textContent=g()}function S(){const e=localStorage.getItem("customIntervalConfig");if(e){const n=JSON.parse(e);Object.assign(t,n);const i=k();for(let e=1;e<=i;e++){const t=document.getElementById(`day${e}`);t&&n[e]&&(t.value=n[e].checks.join(", "))}}}function k(){const e=Object.keys(t).map(Number).filter(e=>!isNaN(e));return e.length>0?Math.max(...e):5}function I(e){if(!e)return;const t=e.value,n=k();e.innerHTML="";for(let t=1;t<=n;t++){const n=document.createElement("option");n.value=t,n.textContent=`Day ${t}`,e.appendChild(n)}e.value=t&&t<=n?t:1}function D(){I(document.getElementById("daySelect")),I(document.getElementById("splashDaySelect"))}a.addEventListener("click",function(){n.isRunning||a.disabled||(a.disabled=!0,setTimeout(()=>{a.disabled=!1},500),n.isRunning=!0,0===n.sessionLog.length?(n.currentTime=0,n.currentCheck=0,n.checkStartTime=Date.now(),n.startTime=(new Date).toISOString(),y("Baby started crying - Day "+n.currentDay)):(n.currentTime=0,y("Baby started crying again")),a.style.display="none",s.style.display="block",c.style.display="block",o.disabled=!1,h(),n.interval=setInterval(()=>{n.currentTime++,u(),f();const e=g();n.currentTime>=60*e&&o.classList.add("color-orange")},1e3))}),s.addEventListener("click",function(){n.isRunning&&(clearInterval(n.interval),n.isRunning=!1,n.currentTime=0,o.classList.remove("color-orange"),a.style.display="block",s.style.display="none",y(`Baby stopped crying - Timer paused at check ${n.currentCheck+1}`),u(),f())}),o.addEventListener("click",function(){const t=g(),i=Math.floor(n.currentTime/60);n.currentTime<60*t?e.dialog.confirm(`You've only waited ${i} minutes. Recommended wait time is ${t} minutes. Check anyway?`,"Early Check Warning",()=>{v(i)}):v(i)}),c.addEventListener("click",function(){n.interval&&clearInterval(n.interval),n.isRunning=!1,e.toast.create({text:'<div style="text-align: center;"><i class="icon f7-icons" style="font-size: 48px;">moon_zzz_fill</i><br>Sweet dreams! ðŸ˜´</div>',position:"center",closeTimeout:3e3}).open(),n.sessionLog.length>0&&y("Session completed - Baby sleeping"),n.currentTime=0,n.currentCheck=0,n.sessionLog=[],a.style.display="block",s.style.display="none",c.style.display="none",o.disabled=!0,o.classList.remove("color-orange"),u(),h(),p(),f()}),l.addEventListener("change",e=>{n.currentDay=parseInt(e.target.value),h(),localStorage.setItem("lastTrainingDay",JSON.stringify({day:n.currentDay,date:(new Date).toISOString()})),n.isRunning||(n.sessionLog=[],p())}),u(),h(),p(),function(){const e=localStorage.getItem("timerState");if(e){const t=JSON.parse(e),i=Math.floor((Date.now()-t.savedAt)/1e3);n={...t,currentTime:t.currentTime+i,interval:null},a.style.display="none",s.style.display="block",c.style.display="block",o.disabled=!1,u(),h(),p(),n.interval=setInterval(()=>{n.currentTime++,u(),f();const e=g();n.currentTime>=60*e&&o.classList.add("color-orange")},1e3)}}(),S(),D(),setTimeout(()=>{n.isRunning||function(){const t=JSON.parse(localStorage.getItem("lastTrainingDay")||"{}"),i=e.popup.create({el:"#splash-popup",closeByBackdropClick:!1,closeOnEscape:!1}),a=document.getElementById("splashDaySelect"),s=document.getElementById("dayHint"),o=document.getElementById("startAppBtn");if(t.date){const e=new Date(t.date),i=new Date,o=Math.floor((i-e)/864e5);let c=t.day||1;o>=1&&c<5&&(c=Math.min(c+o,5)),a.value=c,n.currentDay=c,s.innerHTML=0===o?`<small>Continuing from today (Day ${t.day})</small>`:1===o?`<small>Yesterday was Day ${t.day}, suggesting Day ${c}</small>`:`<small>Last session was ${o} days ago (Day ${t.day})</small>`}else s.innerHTML="<small>First time? Start with Day 1</small>";a.addEventListener("change",e=>{n.currentDay=parseInt(e.target.value),l.value=e.target.value,h()}),o.addEventListener("click",()=>{localStorage.setItem("lastTrainingDay",JSON.stringify({day:n.currentDay,date:(new Date).toISOString()})),i.close()}),i.open()}()},100)});